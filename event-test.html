<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Event Listener Demo</title>
  <script src="https://cdn.jsdelivr.net/npm/ethers@6.11.1/dist/ethers.umd.min.js"></script>
</head>
<body style="background:#111; color:#fff; font-family:Arial; padding:20px;">

<h2>Event Listener Demo</h2>

<button id="connect">è¿æ¥é’±åŒ…</button>

<p>å½“å‰è´¦å·ï¼š<span id="addr">æœªè¿æ¥</span></p >

<hr>

<script>
const CONTRACT_ADDRESS = "0xCFFE24918BB30638D135C326c78Ab217A59d565c";

const ABI = [
	{
		"inputs": [],
		"name": "deposit",
		"outputs": [],
		"stateMutability": "payable",
		"type": "function"
	},
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": true,
				"internalType": "address",
				"name": "user",
				"type": "address"
			},
			{
				"indexed": false,
				"internalType": "uint256",
				"name": "amount",
				"type": "uint256"
			}
		],
		"name": "Deposit",
		"type": "event"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "amount",
				"type": "uint256"
			}
		],
		"name": "withdraw",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": true,
				"internalType": "address",
				"name": "user",
				"type": "address"
			},
			{
				"indexed": false,
				"internalType": "uint256",
				"name": "amount",
				"type": "uint256"
			}
		],
		"name": "Withdraw",
		"type": "event"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			}
		],
		"name": "balances",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	}
];

let provider, signer, contract;

document.getElementById("connect").onclick = async () => {
  provider = new ethers.BrowserProvider(window.ethereum);
  signer = await provider.getSigner();
  const addr = await signer.getAddress();
  document.getElementById("addr").textContent = addr;

  contract = new ethers.Contract(CONTRACT_ADDRESS, ABI, signer);

  // ç›‘å¬äº‹ä»¶ï¼ˆé‡ç‚¹ï¼‰
  contract.on("MessageChanged", (user, oldMsg, newMsg) => {
    console.log("ğŸ“¢ äº‹ä»¶è§¦å‘ï¼");
    console.log("ç”¨æˆ·ï¼š", user);
    console.log("æ—§æ¶ˆæ¯ï¼š", oldMsg);
    console.log("æ–°æ¶ˆæ¯ï¼š", newMsg);
    alert(`äº‹ä»¶è§¦å‘ï¼š${newMsg}`);
  });

  alert("å·²è¿æ¥å¹¶å¼€å§‹ç›‘å¬äº‹ä»¶ï¼");
}
</script>

</body>
</html>
